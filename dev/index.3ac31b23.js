let e;const t=Math.floor(10.071428571428571),s={BACKGROUND:"#edf1e7",TEXT:"#000",DEFENSE_OPTION_TEXT:"#000",DEFENSE_OPTION_TEXT_INACTIVE:"#f00",BUTTON:"#444",BUTTON_TEXT:"#fff",PROGRESS_BAR:"#4CAF50",BORDER:"#333",DEBUG_LINE:"rgba(0,0,0,0.1)",SELECTION:"rgba(255,80,80,0.7)"},i={baseDuration:3e4,durationIncrease:5e3,maxLevels:20,difficultyMultiplier:.75,meteorWeights:{start:{small:1,medium:0,large:0},end:{small:.65,medium:.25,large:.1}},minSpawnGap:1e3,maxSpawnGap:1500,minSpawnGapEnd:500,difficultyRamp:1.15,waveDuration:6e3,waveGap:3200},a=function(e=i){let t=[],s=e.difficultyMultiplier;for(let i=0;i<e.maxLevels;i++){let o=(e.baseDuration+e.durationIncrease*i)/Math.sqrt(s),c=[],d=1e3;for(e.difficultyRamp;d<o-2e3;){let t=d+e.waveDuration/Math.sqrt(s);for(;d<t;){var a,l,h,r,n;let i=(d-(t-e.waveDuration))/e.waveDuration,o=function(e){let t=Math.random()*(e.small+e.medium+e.large);return t<e.small?0:t<e.small+e.medium?1:2}({small:(a=e.meteorWeights.start.small,a+(e.meteorWeights.end.small/s-a)*i),medium:(l=e.meteorWeights.start.medium,l+(e.meteorWeights.end.medium*s-l)*i),large:(h=e.meteorWeights.start.large,h+(e.meteorWeights.end.large*s-h)*i)}),m=Math.floor(6*Math.random());c.push({type:o,lane:m,startTime:Math.floor(d)});let f=(r=e.maxSpawnGap/s,r+(e.minSpawnGapEnd/s-r)*i);d+=Math.random()*(n=e.maxSpawnGap/s,n+(2*e.minSpawnGapEnd/s-n)*i-f)+f}d+=e.waveGap/s}t.push({name:`Level ${i+1}`,duration:o,meteors:c.sort((e,t)=>e.startTime-t.startTime)})}return t}(),l={LOADING:"loading",MENU:"menu",PLAYING:"playing",LEVEL_COMPLETE:"levelComplete",GAME_OVER:"gameover",GAME_COMPLETE:"gameComplete"},h=[{id:0,name:"Basic",color:"#4CAF50",cost:100,damage:10,health:100},{id:1,name:"Medium",color:"#2196F3",cost:150,damage:20,health:100},{id:2,name:"Strong",color:"#9C27B0",cost:200,damage:30,health:100}],r=[{id:0,name:"Small",color:"#FF9999",health:30,speed:.05,damageRate:30,rotateRate:5e-4,wiggleRate:.001,wiggleAmount:7,sizeMultiplier:{x:1,y:1},coinReward:20},{id:1,name:"Medium",color:"#FF4444",health:50,speed:.035,damageRate:50,rotateRate:0,wiggleRate:.03,wiggleAmount:.03,sizeMultiplier:{x:1,y:2},coinReward:40},{id:2,name:"Large",color:"#FF0000",health:70,speed:.05,damageRate:50,rotateRate:0,wiggleRate:.03,wiggleAmount:.03,sizeMultiplier:{x:1,y:2},coinReward:50}],n={SMALL:{size:"12px",family:"Arial",get full(){return`${this.size} ${this.family}`}},LARGE:{size:"14px",family:"Arial",get full(){return`${this.size} ${this.family}`}}},o=["/assets/img/meteor-1.png","/assets/img/meteor-2.png","/assets/img/meteor-3.png"];class c{constructor(){this.images=new Map,this.totalAssets=0,this.loadedAssets=0}async loadAll(){let e=o.map((e,t)=>this.loadImage(`meteor-${t}`,e));try{return await Promise.all(e),!0}catch(e){return console.error("Error loading assets:",e),!1}}loadImage(e,t){return new Promise((s,i)=>{let a=new Image;this.totalAssets++,a.onload=()=>{this.images.set(e,a),this.loadedAssets++,s(a)},a.onerror=()=>{i(Error(`Failed to load image: ${t}`))},a.src=t})}getImage(e){return this.images.get(e)}getLoadingProgress(){return this.totalAssets?this.loadedAssets/this.totalAssets:0}}class d{constructor(e,t=r[0]){this.lane=e,this.type=t,this.y=80,this.health=t.health,this.speed=t.speed,this.isBlocked=!1,this.blockingDefense=null,this.baseRotation=0,this.wiggleRotation=0,this.wiggleOffset=0,this.baseX=40+46.666666666666664*e+23.333333333333332}update(e){this.isBlocked||(this.y+=this.speed*e,this.baseRotation+=this.type.rotateRate*e,this.wiggleOffset+=this.type.wiggleRate*e,this.wiggleRotation=Math.cos(this.wiggleOffset)*this.type.wiggleAmount*.5)}block(e){this.isBlocked=!0,this.blockingDefense=e}unblock(){this.isBlocked=!1,this.blockingDefense=null}draw(t){let s=this.baseX+Math.sin(this.wiggleOffset)*this.type.wiggleAmount,i=e?.assetLoader.getImage(`meteor-${this.type.id}`);if(i){t.save(),t.translate(s,this.y),t.rotate(this.baseRotation+this.wiggleRotation);let e=37.333333333333336*this.type.sizeMultiplier.y,a=37.333333333333336*this.type.sizeMultiplier.x;t.drawImage(i,-a/2,-e/2,a,e),t.restore()}else t.fillStyle=this.type.color,t.beginPath(),t.arc(s,this.y,10,0,2*Math.PI),t.fill()}takeDamage(e){return this.health-=e,this.health<=0}}class m{constructor(e,t,i,a,l,h=s.BUTTON,r=s.BUTTON_TEXT,n=16){this.x=e,this.y=t,this.width=i,this.height=a,this.text=l,this.backgroundColor=h,this.textColor=r,this.fontSize=n}isClicked(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height}draw(e){e.fillStyle=this.backgroundColor,e.fillRect(this.x,this.y,this.width,this.height),e.fillStyle=this.textColor,e.font=n.LARGE.full,e.textAlign="center",e.textBaseline="middle",e.fillText(this.text,this.x+this.width/2,this.y+this.height/2)}}class f{constructor(e,t,s){this.x=e,this.y=t,this.speed=.3,this.damage=s,this.size=4}update(e){this.y-=this.speed*e}draw(e){e.fillStyle="black",e.beginPath(),e.arc(this.x,this.y,this.size,0,2*Math.PI),e.fill()}checkCollision(e){let t=40+46.666666666666664*e.lane+23.333333333333332,s=this.x-t,i=this.y-e.y;return Math.sqrt(s*s+i*i)<this.size+10}isOffScreen(){return this.y<80}}class g{constructor(e=null){this.type=e,this.health=e?e.health:0,this.maxHealth=e?e.health:0,this.projectiles=[],this.lastFireTime=0,this.fireRate=1e3,this.blockingMeteors=[]}isEmpty(){return null===this.type}takeDamage(e){return this.health-=e,this.health<=0}update(e,t,s,i,a){if(!this.isEmpty()){e-this.lastFireTime>this.fireRate&&(this.projectiles.push(new f(t,s,this.type.damage)),this.lastFireTime=e);let l=Math.floor((s-80)/46.666666666666664);i.forEach(e=>{Math.floor((e.y-80)/46.666666666666664)===l&&e.lane===Math.floor((t-40)/46.666666666666664)&&(e.isBlocked||(e.block(this),this.blockingMeteors.push(e)),e.blockingDefense===this&&this.takeDamage(e.type.damageRate/60)&&(this.blockingMeteors.forEach(e=>e.unblock()),this.blockingMeteors=[],this.type=null,this.health=0,this.maxHealth=0))}),this.projectiles=this.projectiles.filter(e=>{e.update(16);for(let t=0;t<i.length;t++){let s=i[t];if(e.checkCollision(s)){if(s.takeDamage(e.damage)){let e=40+46.666666666666664*s.lane+23.333333333333332;a.push(new y(e,s.y,s.type.coinReward)),i.splice(t,1)}return!1}}return!e.isOffScreen()})}}draw(e,t,i,a,l=!1,h=!1){e.strokeStyle=this.isEmpty()?s.DEBUG_LINE:"#888",e.lineWidth=1,e.strokeRect(t-a/2,i-a/2,a,a),!this.isEmpty()&&(e.fillStyle=this.type.color,h?e.globalAlpha=.5:e.globalAlpha=Math.max(.3,this.health/this.maxHealth),e.fillRect(t-a/2,i-a/2,a,a),e.globalAlpha=1,this.projectiles.forEach(t=>t.draw(e)),l&&(e.strokeStyle=s.SELECTION,e.lineWidth=4,e.strokeRect(t-a/2,i-a/2,a,a)))}}class u{constructor(e,t,s){this.type=e,this.x=t,this.y=s,this.defense=new g(e)}draw(e,t=!1,i=0){let a=i<this.type.cost;this.defense.draw(e,this.x+23.333333333333332,this.y+23.333333333333332,46.666666666666664,t,a),e.fillStyle=a?s.DEFENSE_OPTION_TEXT_INACTIVE:s.DEFENSE_OPTION_TEXT,e.font=n.LARGE.full,e.textAlign="center",e.fillText(`$${this.type.cost}`,this.x+23.333333333333332,this.y+46.666666666666664+15)}isClicked(e,t){return e>=this.x&&e<=this.x+46.666666666666664&&t>=this.y&&t<=this.y+46.666666666666664}}class p{constructor(e,t,s,i){this.x=e,this.y=t,this.row=s,this.lane=i,this.defense=new g}isEmpty(){return this.defense.isEmpty()}placeDefense(e){return!!this.isEmpty()&&(this.defense=new g(e),!0)}removeDefense(){this.defense=new g}draw(e){this.defense.draw(e,this.x,this.y,46.666666666666664)}update(e,t,s){this.defense.update(e,this.x,this.y,t,s)}}class y{constructor(e,t,s=10){this.x=e,this.y=t,this.value=s,this.lifetime=5e3,this.createTime=performance.now(),this.hitRadius=30,this.size=8+(s-10)/10*2;let i=Math.random()*Math.PI*2,a=.3+.1*Math.random();this.vx=Math.cos(i)*a,this.vy=Math.sin(i)*a,this.waveAmplitude=2.2+.2*Math.random(),this.waveFrequency=.005+.001*Math.random(),this.waveOffset=Math.random()*Math.PI*2,this.baseX=e,this.baseY=t,this.time=0}draw(e,t){let s=t-this.createTime,i=this.lifetime-s;if(i<1500&&Math.floor(t/(100+i/1500*400))%2==0)return;let a=this.x+Math.sin(this.time*this.waveFrequency+this.waveOffset)*this.waveAmplitude,l=this.y+Math.cos(this.time*this.waveFrequency+this.waveOffset)*this.waveAmplitude,h=e.createRadialGradient(a-this.size/3,l-this.size/3,0,a,l,this.size);h.addColorStop(0,"#FFD700"),h.addColorStop(1,"#DAA520"),e.fillStyle=h,e.beginPath(),e.arc(a,l,this.size,0,2*Math.PI),e.fill(),e.strokeStyle="#B8860B",e.lineWidth=1,e.stroke(),e.fillStyle="black",e.font=`bold ${Math.max(10,this.size)}px ${n.SMALL.family}`,e.textAlign="center",e.textBaseline="middle",e.fillText(`${this.value}`,a,l)}update(e){return this.time+=16,this.baseX+=this.vx,this.baseY+=this.vy,this.x=this.baseX+Math.sin(this.time*this.waveFrequency+this.waveOffset)*this.waveAmplitude,this.y=this.baseY+Math.cos(this.time*this.waveFrequency+this.waveOffset)*this.waveAmplitude,e-this.createTime<this.lifetime}isClicked(e,t){let s=e-this.x,i=t-this.y;return Math.sqrt(s*s+i*i)<this.hitRadius}}class w{constructor(){this.currentLevel=0,this.levelStartTime=0,this.remainingMeteors=[],this.allMeteorsSpawned=!1}startLevel(e){this.currentLevel=e,this.levelStartTime=performance.now(),this.remainingMeteors=[...a[e].meteors],this.allMeteorsSpawned=!1}update(e,t){if(this.currentLevel>=a.length)return!1;let s=e-this.levelStartTime;if(s>=a[this.currentLevel].duration)return this.allMeteorsSpawned=!0,!1;for(;this.remainingMeteors.length>0&&s>=this.remainingMeteors[0].startTime;){let e=this.remainingMeteors.shift();t.push(new d(e.lane,r[e.type]))}return 0===this.remainingMeteors.length&&(this.allMeteorsSpawned=!0),!0}isLevelComplete(e){return this.allMeteorsSpawned&&0===e.length}getLevelProgress(){return Math.min((performance.now()-this.levelStartTime)/a[this.currentLevel].duration,1)}}class x{constructor(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.lastTime=0,this.meteors=[],this.coins=[],this.assetLoader=new c,this.gameState=l.LOADING,this.initializeCanvas(),window.addEventListener("resize",()=>this.initializeCanvas()),this.loadAssets(),requestAnimationFrame(e=>this.gameLoop(e)),this.testMeteor=new d(2),this.gameState=l.MENU,this.setupEventListeners(),this.startButton=new m(130,295,100,50,"Start Game"),this.retryButton=new m(130,295,100,50,"Try Again"),this.gameOverText=new m(80,220,200,50,"Game Over!","transparent","red",24),this.currency=500,this.defenseOptions=this.createDefenseOptions(),this.selectedDefense=null,this.defenseGrid=this.createDefenseGrid(),this.levelManager=new w,this.nextLevelButton=new m(120,370,120,40,"Next Level"),this.levelCompleteText=new m(80,270,200,50,"Level Complete!","transparent","#4CAF50",24),this.gameCompleteText=new m(80,270,200,50,"Game Complete!","transparent","#4CAF50",24)}initializeCanvas(){let e;let t=window.innerWidth,s=window.innerHeight;e=Math.min(e=t/s>.5625?s/640:t/360,1),this.canvas.width=360,this.canvas.height=640,this.canvas.style.width=`${360*e}px`,this.canvas.style.height=`${640*e}px`}setupEventListeners(){this.canvas.addEventListener("click",e=>{let t=this.canvas.getBoundingClientRect(),s=this.canvas.width/t.width,i=(e.clientX-t.left)*s,a=(e.clientY-t.top)*s;if(this.gameState===l.MENU)this.startButton.isClicked(i,a)&&this.startGame();else if(this.gameState===l.GAME_OVER)this.retryButton.isClicked(i,a)&&this.startGame();else if(this.gameState===l.LEVEL_COMPLETE)this.nextLevelButton.isClicked(i,a)&&this.startNextLevel();else if(this.gameState===l.PLAYING){let e=!1;for(let t=this.coins.length-1;t>=0;t--){let s=this.coins[t];if(s.isClicked(i,a)){this.currency+=s.value,this.coins.splice(t,1),e=!0;break}}if(!e&&(this.defenseOptions.forEach(e=>{e.isClicked(i,a)&&(this.selectedDefense===e.type?(this.selectedDefense=null,console.log("Defense deselected")):this.currency>=e.type.cost?(this.selectedDefense=e.type,console.log(`Selected ${e.type.name} defense`)):console.log("Not enough currency!"))}),this.selectedDefense)){let e=this.getSpotAtPosition(i,a);e&&e.isEmpty()&&this.currency>=this.selectedDefense.cost&&(e.placeDefense(this.selectedDefense),this.currency-=this.selectedDefense.cost,this.selectedDefense=null)}}})}startGame(){this.gameState=l.PLAYING,this.meteors=[],this.coins=[],this.currency=500,this.selectedDefense=null,this.levelManager.startLevel(0);for(let e=0;e<this.defenseGrid.length;e++)for(let t=0;t<this.defenseGrid[e].length;t++)this.defenseGrid[e][t].removeDefense()}startNextLevel(){this.meteors=[],this.coins=[],this.currency=500,this.selectedDefense=null;for(let e=0;e<this.defenseGrid.length;e++)for(let t=0;t<this.defenseGrid[e].length;t++)this.defenseGrid[e][t].removeDefense();this.levelManager.startLevel(this.levelManager.currentLevel+1),this.gameState=l.PLAYING}gameLoop(e){let t=e-this.lastTime;this.lastTime=e,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.update(t),this.draw(),requestAnimationFrame(e=>this.gameLoop(e))}drawBackground(){this.ctx.fillStyle=s.BACKGROUND,this.ctx.fillRect(0,0,360,640),this.ctx.strokeStyle=s.BORDER,this.ctx.strokeRect(40,80,this.gameAreaWidth,this.gameAreaHeight);for(let e=0;e<=6;e++){let t=40+e*this.laneWidth;this.ctx.beginPath(),this.ctx.moveTo(t,80),this.ctx.lineTo(t,550),this.ctx.stroke()}this.ctx.fillStyle=s.BACKGROUND,this.ctx.fillRect(0,0,360,80),this.ctx.fillRect(0,550,360,90),this.ctx.fillRect(0,80,40,this.gameAreaHeight),this.ctx.fillRect(320,80,40,this.gameAreaHeight);for(let e=0;e<this.defenseGrid.length;e++)for(let t=0;t<this.defenseGrid[e].length;t++)this.defenseGrid[e][t].draw(this.ctx)}update(e){if(this.gameState!==l.PLAYING)return;let t=performance.now();for(let e=0;e<this.defenseGrid.length;e++)for(let s=0;s<this.defenseGrid[e].length;s++)this.defenseGrid[e][s].update(t,this.meteors,this.coins);this.meteors=this.meteors.filter(t=>(t.update(e),!(t.y>=550)||(this.gameState=l.GAME_OVER,!1))),this.coins=this.coins.filter(e=>e.update(t)),this.levelManager.update(t,this.meteors),this.levelManager.isLevelComplete(this.meteors)&&(this.levelManager.currentLevel>=a.length-1?this.gameState=l.GAME_COMPLETE:this.gameState=l.LEVEL_COMPLETE)}drawCurrency(){this.ctx.fillStyle=s.TEXT,this.ctx.font=n.LARGE.full,this.ctx.textAlign="left",this.ctx.fillText(`Currency: $${this.currency}`,40/3,60)}draw(){if(this.drawBackground(),this.gameState===l.LOADING)this.drawLoadingScreen();else if(this.gameState===l.MENU)this.startButton.draw(this.ctx);else if(this.gameState===l.PLAYING){this.drawCurrency(),this.drawProgressBar(this.ctx),this.defenseOptions.forEach(e=>{e.draw(this.ctx,this.selectedDefense&&e.type.id===this.selectedDefense.id,this.currency)}),this.meteors.forEach(e=>e.draw(this.ctx));let e=performance.now();this.coins.forEach(t=>t.draw(this.ctx,e))}else this.gameState===l.LEVEL_COMPLETE?(this.levelCompleteText.draw(this.ctx),this.nextLevelButton.draw(this.ctx)):this.gameState===l.GAME_COMPLETE?this.gameCompleteText.draw(this.ctx):this.gameState===l.GAME_OVER&&(this.gameOverText.draw(this.ctx),this.retryButton.draw(this.ctx))}createDefenseOptions(){let e=(360-(66.66666666666666*h.length-20))/2;return h.map((t,s)=>new u(t,e+66.66666666666666*s,570))}createDefenseGrid(){let e=[];for(let s=0;s<t;s++){let t=[];for(let e=0;e<6;e++){let i=40+46.666666666666664*e+23.333333333333332,a=550-46.666666666666664*s-23.333333333333332;t.push(new p(i,a,s,e))}e.push(t)}return e}getSpotAtPosition(e,t){for(let s=0;s<this.defenseGrid.length;s++)for(let i=0;i<this.defenseGrid[s].length;i++){let a=this.defenseGrid[s][i];if(e>=a.x-23.333333333333332&&e<=a.x+23.333333333333332&&t>=a.y-23.333333333333332&&t<=a.y+23.333333333333332)return a}return null}drawProgressBar(e){e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(50,20,260,20);let t=1-this.levelManager.getLevelProgress();e.fillStyle=s.PROGRESS_BAR,e.fillRect(50,20,260*t,20),e.strokeStyle=s.BORDER,e.strokeRect(50,20,260,20),e.fillStyle=s.TEXT,e.font=n.LARGE.full,e.textAlign="center",e.fillText(`${a[this.levelManager.currentLevel].name}`,180,56);let i=Math.ceil((a[this.levelManager.currentLevel].duration-(performance.now()-this.levelManager.levelStartTime))/1e3);i>0&&(e.font=n.SMALL.full,e.fillText(`${i}s`,330,35))}async loadAssets(){await this.assetLoader.loadAll()?this.gameState=l.MENU:console.error("Failed to load assets")}drawLoadingScreen(){let e=this.assetLoader.getLoadingProgress();this.ctx.fillStyle=s.BUTTON,this.ctx.fillRect(80,320,200,20),this.ctx.fillStyle="#4CAF50",this.ctx.fillRect(80,320,200*e,20),this.ctx.strokeStyle=s.TEXT,this.ctx.strokeRect(80,320,200,20),this.ctx.fillStyle=s.TEXT,this.ctx.font=n.LARGE.full,this.ctx.textAlign="center",this.ctx.fillText("Loading...",180,300),this.ctx.fillText(`${Math.floor(100*e)}%`,180,360)}}window.addEventListener("load",()=>{e=new x});
//# sourceMappingURL=index.3ac31b23.js.map
