const e=Math.floor(11.5),t=[{name:"Level 1",duration:3e4,waves:[{type:0,count:3,startTime:1e3,spacing:1e3},{type:0,count:5,startTime:8e3,spacing:800},{type:1,count:2,startTime:15e3,spacing:2e3},{type:0,count:4,startTime:2e4,spacing:500},{type:1,count:3,startTime:25e3,spacing:1500}]},{name:"Level 2",duration:45e3,waves:[{type:1,count:3,startTime:2e3,spacing:1200},{type:0,count:6,startTime:1e4,spacing:400},{type:2,count:1,startTime:18e3,spacing:0},{type:1,count:4,startTime:25e3,spacing:1e3},{type:2,count:2,startTime:35e3,spacing:2e3},{type:0,count:8,startTime:4e4,spacing:300}]}],i={MENU:"menu",PLAYING:"playing",LEVEL_COMPLETE:"levelComplete",GAME_OVER:"gameover",GAME_COMPLETE:"gameComplete"},s=[{id:0,name:"Basic",color:"#4CAF50",cost:100,damage:10,health:100},{id:1,name:"Medium",color:"#2196F3",cost:200,damage:20,health:100},{id:2,name:"Strong",color:"#9C27B0",cost:300,damage:30,health:100}],h=[{id:0,name:"Small",color:"#FF9999",health:30,speed:.05,damageRate:30},{id:1,name:"Medium",color:"#FF4444",health:60,speed:.02,damageRate:50},{id:2,name:"Large",color:"#FF0000",health:90,speed:.08,damageRate:50}],a={SMALL:{size:"12px",family:"Arial",get full(){return`${this.size} ${this.family}`}},LARGE:{size:"14px",family:"Arial",get full(){return`${this.size} ${this.family}`}}};class l{constructor(e,t=h[0]){this.lane=e,this.type=t,this.y=80,this.health=t.health,this.speed=t.speed,this.isBlocked=!1,this.blockingDefense=null}update(e){this.isBlocked||(this.y+=this.speed*e)}block(e){this.isBlocked=!0,this.blockingDefense=e}unblock(){this.isBlocked=!1,this.blockingDefense=null}draw(e){let t=80+40*this.lane+20;e.fillStyle=this.type.color,e.beginPath(),e.arc(t,this.y,10,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(255,0,0,0.3)",e.beginPath(),e.arc(t,this.y,10,0,2*Math.PI),e.stroke(),e.fillStyle="white",e.font=a.SMALL.full,e.textAlign="center",e.fillText(`${this.health}`,t,this.y)}takeDamage(e){return this.health-=e,this.health<=0}}class r{constructor(e,t,i,s,h,a="#444",l="white",r=16){this.x=e,this.y=t,this.width=i,this.height=s,this.text=h,this.backgroundColor=a,this.textColor=l,this.fontSize=r}isClicked(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height}draw(e){e.fillStyle=this.backgroundColor,e.fillRect(this.x,this.y,this.width,this.height),e.fillStyle=this.textColor,e.font=a.LARGE.full,e.textAlign="center",e.textBaseline="middle",e.fillText(this.text,this.x+this.width/2,this.y+this.height/2)}}class n{constructor(e,t,i){this.x=e,this.y=t,this.speed=.3,this.damage=i,this.size=4}update(e){this.y-=this.speed*e}draw(e){e.fillStyle="yellow",e.beginPath(),e.arc(this.x,this.y,this.size,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(255,255,0,0.3)",e.beginPath(),e.arc(this.x,this.y,this.size,0,2*Math.PI),e.stroke()}checkCollision(e){let t=80+40*e.lane+20,i=this.x-t,s=this.y-e.y;return Math.sqrt(i*i+s*s)<this.size+10}isOffScreen(){return this.y<80}}class o{constructor(e=null){this.type=e,this.health=e?e.health:0,this.maxHealth=e?e.health:0,this.projectiles=[],this.lastFireTime=0,this.fireRate=1e3,this.blockingMeteors=[]}isEmpty(){return null===this.type}takeDamage(e){return this.health-=e,this.health<=0}update(e,t,i,s,h){if(!this.isEmpty()){e-this.lastFireTime>this.fireRate&&(this.projectiles.push(new n(t,i,this.type.damage)),this.lastFireTime=e);let a=Math.floor((i-80)/40);s.forEach(e=>{Math.floor((e.y-80)/40)===a&&e.lane===Math.floor((t-80)/40)&&(e.isBlocked||(e.block(this),this.blockingMeteors.push(e)),e.blockingDefense===this&&this.takeDamage(e.type.damageRate/60)&&(this.blockingMeteors.forEach(e=>e.unblock()),this.blockingMeteors=[],this.type=null,this.health=0,this.maxHealth=0))}),this.projectiles=this.projectiles.filter(e=>{e.update(16);for(let t=0;t<s.length;t++){let i=s[t];if(e.checkCollision(i)){if(i.takeDamage(e.damage)){let e=80+40*i.lane+20;h.push(new f(e,i.y)),s.splice(t,1)}return!1}}return!e.isOffScreen()})}}draw(e,t,i,s,h=!1,l=!1){e.strokeStyle=this.isEmpty()?"#666":"#888",e.lineWidth=1,e.strokeRect(t-s/2,i-s/2,s,s),!this.isEmpty()&&(e.fillStyle=this.type.color,l?e.globalAlpha=.5:e.globalAlpha=Math.max(.3,this.health/this.maxHealth),e.fillRect(t-s/2,i-s/2,s,s),e.globalAlpha=1,this.projectiles.forEach(t=>t.draw(e)),e.fillStyle="white",e.font=a.SMALL.full,e.textAlign="center",e.fillText(`${Math.floor(this.health/this.maxHealth*100)}%`,t,i),h&&(e.strokeStyle="yellow",e.lineWidth=2,e.strokeRect(t-s/2,i-s/2,s,s)))}}class c{constructor(e,t,i){this.type=e,this.x=t,this.y=i,this.defense=new o(e)}draw(e,t=!1,i=0){let s=i<this.type.cost;this.defense.draw(e,this.x+20,this.y+20,40,t,s),e.fillStyle=s?"red":"white",e.font=a.LARGE.full,e.textAlign="center",e.fillText(`$${this.type.cost}`,this.x+20,this.y+40+15)}isClicked(e,t){return e>=this.x&&e<=this.x+40&&t>=this.y&&t<=this.y+40}}class d{constructor(e,t,i,s){this.x=e,this.y=t,this.row=i,this.lane=s,this.defense=new o}isEmpty(){return this.defense.isEmpty()}placeDefense(e){return!!this.isEmpty()&&(this.defense=new o(e),!0)}removeDefense(){this.defense=new o}draw(e){this.defense.draw(e,this.x,this.y,40),e.fillStyle="#666",e.font=a.SMALL.full,e.textAlign="center",e.fillText(`${this.lane},${this.row}`,this.x,this.y)}update(e,t,i){this.defense.update(e,this.x,this.y,t,i)}}class f{constructor(e,t,i=10){this.x=e,this.y=t,this.value=i,this.lifetime=5e3,this.createTime=performance.now(),this.size=8,this.hitRadius=35;let s=Math.random()*Math.PI*2,h=.3+.1*Math.random();this.vx=Math.cos(s)*h,this.vy=Math.sin(s)*h,this.waveAmplitude=2+.5*Math.random(),this.waveFrequency=.005+.01*Math.random(),this.waveOffset=Math.random()*Math.PI*2,this.baseX=e,this.baseY=t,this.time=0}update(e){return this.time+=16,this.baseX+=this.vx,this.baseY+=this.vy,this.x=this.baseX+Math.sin(this.time*this.waveFrequency+this.waveOffset)*this.waveAmplitude,this.y=this.baseY+Math.cos(this.time*this.waveFrequency+this.waveOffset)*this.waveAmplitude,e-this.createTime<this.lifetime}draw(e,t){let i=t-this.createTime,s=this.lifetime-i;s<1500&&Math.floor(t/(100+s/1500*400))%2==0||(e.strokeStyle="rgba(255, 215, 0, 0.3)",e.beginPath(),e.arc(this.x,this.y,this.hitRadius,0,2*Math.PI),e.stroke(),e.fillStyle="#FFD700",e.beginPath(),e.arc(this.x,this.y,this.size,0,2*Math.PI),e.fill(),e.fillStyle="black",e.font=a.SMALL.full,e.textAlign="center",e.textBaseline="middle",e.fillText("$",this.x,this.y))}isClicked(e,t){let i=e-this.x,s=t-this.y;return Math.sqrt(i*i+s*s)<this.hitRadius}}class m{constructor(){this.currentLevel=0,this.levelStartTime=0,this.waveStates=new Map,this.allWavesComplete=!1}startLevel(e){this.currentLevel=e,this.levelStartTime=performance.now(),this.waveStates=new Map,this.allWavesComplete=!1,t[e].waves.forEach((e,t)=>{this.waveStates.set(t,{meteorsSpawned:0,nextSpawnTime:e.startTime})})}update(e,i){if(this.currentLevel>=t.length)return!1;let s=t[this.currentLevel],a=e-this.levelStartTime;return a>=s.duration?(this.allWavesComplete=!0,!1):(s.waves.forEach((e,t)=>{let s=this.waveStates.get(t);a>=s.nextSpawnTime&&s.meteorsSpawned<e.count&&(i.push(new l(Math.floor(6*Math.random()),h[e.type])),s.meteorsSpawned++,s.nextSpawnTime=a+e.spacing)}),!0)}isLevelComplete(e){return this.allWavesComplete&&0===e.length}getLevelProgress(){return Math.min((performance.now()-this.levelStartTime)/t[this.currentLevel].duration,1)}}class g{constructor(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.lastTime=0,this.meteors=[],this.coins=[],this.initializeCanvas(),window.addEventListener("resize",()=>this.initializeCanvas()),requestAnimationFrame(e=>this.gameLoop(e)),this.testMeteor=new l(2),this.gameState=i.MENU,this.setupEventListeners(),this.startButton=new r(130,295,100,50,"Start Game"),this.retryButton=new r(130,295,100,50,"Try Again"),this.gameOverText=new r(80,220,200,50,"Game Over!","transparent","red",24),this.currency=500,this.defenseOptions=this.createDefenseOptions(),this.selectedDefense=null,this.defenseGrid=this.createDefenseGrid(),this.levelManager=new m,this.nextLevelButton=new r(120,370,120,40,"Next Level"),this.levelCompleteText=new r(80,270,200,50,"Level Complete!","transparent","#4CAF50",24),this.gameCompleteText=new r(80,270,200,50,"Game Complete!","transparent","#4CAF50",24)}initializeCanvas(){let e=Math.min(window.innerWidth/360,window.innerHeight/640);this.canvas.width=360,this.canvas.height=640,this.canvas.style.width=`${360*e}px`,this.canvas.style.height=`${640*e}px`}setupEventListeners(){this.canvas.addEventListener("click",e=>{let t=this.canvas.getBoundingClientRect(),s=this.canvas.width/t.width,h=(e.clientX-t.left)*s,a=(e.clientY-t.top)*s;if(this.gameState===i.MENU)this.startButton.isClicked(h,a)&&this.startGame();else if(this.gameState===i.GAME_OVER)this.retryButton.isClicked(h,a)&&this.startGame();else if(this.gameState===i.LEVEL_COMPLETE)this.nextLevelButton.isClicked(h,a)&&this.startNextLevel();else if(this.gameState===i.PLAYING){let e=!1;for(let t=this.coins.length-1;t>=0;t--){let i=this.coins[t];if(i.isClicked(h,a)){this.currency+=i.value,this.coins.splice(t,1),e=!0;break}}if(!e&&(this.defenseOptions.forEach(e=>{e.isClicked(h,a)&&(this.currency>=e.type.cost?(this.selectedDefense=e.type,console.log(`Selected ${e.type.name} defense`)):console.log("Not enough currency!"))}),this.selectedDefense)){let e=this.getSpotAtPosition(h,a);e&&e.isEmpty()&&this.currency>=this.selectedDefense.cost&&(e.placeDefense(this.selectedDefense),this.currency-=this.selectedDefense.cost)}}})}startGame(){this.gameState=i.PLAYING,this.meteors=[],this.coins=[],this.currency=500,this.selectedDefense=null,this.levelManager.startLevel(0);for(let e=0;e<this.defenseGrid.length;e++)for(let t=0;t<this.defenseGrid[e].length;t++)this.defenseGrid[e][t].removeDefense()}startNextLevel(){this.meteors=[],this.coins=[],this.currency=500,this.selectedDefense=null;for(let e=0;e<this.defenseGrid.length;e++)for(let t=0;t<this.defenseGrid[e].length;t++)this.defenseGrid[e][t].removeDefense();this.levelManager.startLevel(this.levelManager.currentLevel+1),this.gameState=i.PLAYING}gameLoop(e){let t=e-this.lastTime;this.lastTime=e,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.update(t),this.draw(),requestAnimationFrame(e=>this.gameLoop(e))}drawBackground(){this.ctx.strokeStyle="#333",this.ctx.strokeRect(80,80,this.gameAreaWidth,this.gameAreaHeight);for(let e=0;e<=6;e++){let t=80+e*this.laneWidth;this.ctx.beginPath(),this.ctx.moveTo(t,80),this.ctx.lineTo(t,540),this.ctx.stroke()}this.ctx.fillStyle="#222",this.ctx.fillRect(0,0,360,80),this.ctx.fillRect(0,540,360,100),this.ctx.fillRect(0,80,80,this.gameAreaHeight),this.ctx.fillRect(320,80,40,this.gameAreaHeight);for(let e=0;e<this.defenseGrid.length;e++)for(let t=0;t<this.defenseGrid[e].length;t++)this.defenseGrid[e][t].draw(this.ctx)}update(e){if(this.gameState!==i.PLAYING)return;let s=performance.now();for(let e=0;e<this.defenseGrid.length;e++)for(let t=0;t<this.defenseGrid[e].length;t++)this.defenseGrid[e][t].update(s,this.meteors,this.coins);this.meteors=this.meteors.filter(t=>(t.update(e),!(t.y>=540)||(this.gameState=i.GAME_OVER,!1))),this.coins=this.coins.filter(e=>e.update(s)),this.levelManager.update(s,this.meteors),this.levelManager.isLevelComplete(this.meteors)&&(this.levelManager.currentLevel>=t.length-1?this.gameState=i.GAME_COMPLETE:this.gameState=i.LEVEL_COMPLETE)}drawCurrency(){this.ctx.fillStyle="white",this.ctx.font=a.LARGE.full,this.ctx.textAlign="left",this.ctx.fillText(`Currency: $${this.currency}`,80,40)}draw(){if(this.drawBackground(),this.gameState===i.MENU)this.startButton.draw(this.ctx);else if(this.gameState===i.PLAYING){this.drawCurrency(),this.drawProgressBar(this.ctx),this.defenseOptions.forEach(e=>{e.draw(this.ctx,this.selectedDefense&&e.type.id===this.selectedDefense.id,this.currency)}),this.meteors.forEach(e=>e.draw(this.ctx));let e=performance.now();this.coins.forEach(t=>t.draw(this.ctx,e))}else this.gameState===i.LEVEL_COMPLETE?(this.levelCompleteText.draw(this.ctx),this.nextLevelButton.draw(this.ctx)):this.gameState===i.GAME_COMPLETE?this.gameCompleteText.draw(this.ctx):this.gameState===i.GAME_OVER&&(this.gameOverText.draw(this.ctx),this.retryButton.draw(this.ctx))}createDefenseOptions(){return s.map((e,t)=>new c(e,10,130+70*t))}createDefenseGrid(){let t=[];for(let i=0;i<e;i++){let e=[];for(let t=0;t<6;t++){let s=80+40*t+20,h=540-40*i-20;e.push(new d(s,h,i,t))}t.push(e)}return t}getSpotAtPosition(e,t){for(let i=0;i<this.defenseGrid.length;i++)for(let s=0;s<this.defenseGrid[i].length;s++){let h=this.defenseGrid[i][s];if(e>=h.x-20&&e<=h.x+20&&t>=h.y-20&&t<=h.y+20)return h}return null}drawProgressBar(e){e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(50,20,260,20);let i=1-this.levelManager.getLevelProgress();e.fillStyle=i<.2?"#ff4444":"#4CAF50",e.fillRect(50,20,260*i,20),e.strokeStyle="white",e.strokeRect(50,20,260,20),e.fillStyle="white",e.font=a.LARGE.full,e.textAlign="center",e.fillText(`${t[this.levelManager.currentLevel].name}`,180,56);let s=Math.ceil((t[this.levelManager.currentLevel].duration-(performance.now()-this.levelManager.levelStartTime))/1e3);s>0&&(e.font=a.SMALL.full,e.fillText(`${s}s`,330,35))}}window.addEventListener("load",()=>{new g});
//# sourceMappingURL=index.0fea9d28.js.map
